<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaFind - Header</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; }
        .header { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 15px 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .header-content { display: flex; align-items: center; justify-content: space-between; gap: 20px; }
        .logo { display: flex; align-items: center; gap: 8px; }
        .logo-text { font-size: 24px; font-weight: bold; color: #1f2937; }
        .search-container { flex: 1; max-width: 600px; position: relative; }
        .search-wrapper { display: flex; align-items: center; background: #fafcfa; border: 1.5px solid #4F624E; border-radius: 12px; overflow: hidden; height: 48px; position: relative; }
        .search-select-wrapper { position: relative; display: flex; align-items: center; }
        .search-select { padding: 0 32px 0 18px; border: none; background: transparent; color: #4F624E; font-size: 13px; min-width: 160px; height: 48px; outline: none; font-family: 'Poppins', sans-serif; appearance: none; cursor: pointer; }
        .search-select-arrow { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; font-size: 16px; color: #4F624E; }
        .pipe-separator { width: 1px; height: 28px; background: #d1d5db; margin: 0 10px; display: inline-block; }
        .search-input { flex: 1; padding: 0 48px 0 18px; border: none; outline: none; font-size: 13px; background: transparent; color: #304D30; font-family: 'Poppins', sans-serif; height: 48px; }
        .search-input::placeholder { color: #8ca08c; opacity: 1; }
        .search-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #222; font-size: 22px; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s, color 0.2s; width: 32px; height: 32px; }
        .search-btn:hover { background: none; color: #000; }
        .search-btn i { color: #222 !important; }
        .auth-buttons { display: flex; gap: 20px; margin-left: 30px; }
        .btn { padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; display: inline-block; text-align: center; }
        .btn-outline { color: #304D30 !important; background: #fff; border: 1.5px solid #4F624E; box-shadow: none; outline: none; position: relative; overflow: hidden; border-radius: 30px; transition: color 0.2s, border 0.2s, background 0.2s; }
        .btn-outline:hover { color: #304D30; background: #f9fafb; border: 1.5px solid #304D30; }
        .btn-primary { background: #34AC4F; color: white; border: none; }
        .btn-primary:hover { background: #16a34a; }
        .quick-access-icons { display: flex; gap: 18px; align-items: center; }
        .icon-link { font-size: 22px; margin-right: 28px; }
        .icon-link:last-child { margin-right: 0; }
        .icon-link:hover { color: #22c55e; }
        .profile-initials-circle { display: flex; align-items: center; justify-content: center; width: 38px; height: 38px; border-radius: 50%; background: #304D30; color: #30ae86; font-size: 18px; font-weight: 600; margin-right: 0; text-decoration: none; transition: background 0.2s, box-shadow 0.2s; box-shadow: 0 2px 8px rgba(44,62,80,0.08); border: 1px solid #30ae86; outline: none; cursor: pointer; }
        .profile-initials-circle:focus { box-shadow: 0 0 0 2px #22c55e44; }
        .profile-initials-circle:hover { background: #22c55e; }
        .profile-dropdown { position: fixed; top: 0; right: 0; height: 100vh; min-width: 300px; max-width: 90vw; background: #fff; border-radius: 0 0 0 18px; box-shadow: -4px 0 32px rgba(44,62,80,0.13); z-index: 2000; overflow-y: auto; border: none; opacity: 0; transform: translateX(110%) scale(1); pointer-events: none; transition: opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1); display: flex; flex-direction: column; box-sizing: border-box; }
        .profile-dropdown.open { opacity: 1; transform: translateX(0) scale(1); pointer-events: auto; }
        .profile-dropdown-header { padding: 32px 28px 14px 28px; background: #f6fef8; display: flex; flex-direction: column; align-items: flex-start; border-radius: 0 0 0 18px; box-shadow: 0 2px 8px rgba(44,62,80,0.04); }
        .profile-dropdown-initials { width: 38px; height: 38px; border-radius: 50%; background: #22c55e; color: #fff; font-size: 18px; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-bottom: 6px; }
        .profile-dropdown-name { font-size: 16px; font-weight: 600; color: #222; }
        .profile-dropdown-separator { height: 1.5px; background: #22c55e; margin: 0 0 0 0; opacity: 0.18; }
        .profile-dropdown a, .profile-dropdown .logout-btn { display: flex; align-items: center; padding: 16px 28px; color: #222; text-decoration: none; font-size: 16px; background: none; border: none; width: 100%; text-align: left; cursor: pointer; transition: background 0.18s; font-weight: 500; }
        .profile-dropdown a:hover, .profile-dropdown .logout-btn:hover { background: #f3f4f6; }
        .profile-dropdown a i, .profile-dropdown .logout-btn i { margin-right: 10px; width: 18px; text-align: center; }
        .profile-dropdown .logout-btn { font-family: inherit; }
        @media (max-width: 900px) { .profile-dropdown { min-width: 80vw; max-width: 100vw; } }
        @media (max-width: 600px) { .profile-dropdown { min-width: 100vw; max-width: 100vw; border-radius: 0 0 0 12px; } .profile-dropdown-header { padding: 22px 14px 8px 14px; border-radius: 0 0 0 12px; } .profile-dropdown a, .profile-dropdown .logout-btn { font-size: 17px; padding: 18px 16px; } }
        .fadeout-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.85);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .fadeout-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }
        .loader {
            border: 5px solid #e0e0e0;
            border-top: 5px solid #34AC4F;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-text">PharmaFind</span>
                </div>
                <div class="search-container">
                    <form class="search-wrapper" method="get" action="{% url 'search' %}">
                        <span class="search-select-wrapper">
                            <select class="search-select" name="categorie" id="categorySelect">
                                <option value="">Toutes les catégories</option>
                                {% if categories %}
                                    {% for cat in categories %}
                                        <option value="{{ cat.id }}" {% if cat.id|stringformat:'s' == selected_categorie|stringformat:'s' %}selected{% endif %}>{{ cat.name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <span class="search-select-arrow">▼</span>
                        </span>
                        <span class="pipe-separator"></span>
                        <input type="text" class="search-input" name="q" placeholder="Rechercher une pharmacie, un médicament" value="{{ query|default:'' }}">
                        <button class="search-btn" type="submit" tabindex="-1"><i class="fas fa-search"></i></button>
                    </form>
                </div>
                {% if not user.is_authenticated %}
                <div class="auth-buttons">
                    <a href="{% url 'connexion' %}" class="btn btn-outline">Connexion</a>
                    <a href="{% url 'Ins' %}" class="btn btn-primary">Inscription</a>
                </div>
                {% endif %}
                {% if user.is_authenticated %}
                <div class="quick-access-icons" style="display: flex; gap: 18px; align-items: center;">
                    <a href="{% url 'reservations' %}" title="Réservations" class="icon-link"><i class="fas fa-calendar-check"></i></a>
                    <a href="{% url 'commandes' %}" title="Commandes" class="icon-link"><i class="fas fa-box"></i></a>
                    <button type="button" title="Profil" class="profile-initials-circle" id="profileDropdownBtn" style="border:none;background:none;padding:0;cursor:pointer;">
                        {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}
                    </button>
                </div>
                <div class="profile-dropdown" id="profileDropdownMenu">
                    <div class="profile-dropdown-header">
                        <div class="profile-dropdown-initials">{{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}</div>
                        <div class="profile-dropdown-name">{{ user.first_name }} {{ user.last_name }}</div>
                    </div>
                    <div class="profile-dropdown-separator"></div>
                    <a href="{% url 'reservations' %}"><i class="fas fa-calendar-check"></i> Réservations</a>
                    <div class="profile-dropdown-separator"></div>
                    <a href="{% url 'commandes' %}"><i class="fas fa-box"></i> Commandes</a>
                    <div class="profile-dropdown-separator"></div>
                    <a href="{% url 'profil' %}?settings=1"><i class="fas fa-cog"></i> Paramètres</a>
                    <div class="profile-dropdown-separator"></div>
                    <a href="{% url 'connexion' %}">Changer de compte</a>
                </div>
                {% endif %}
            </div>
        </div>
    </header>
    <div class="fadeout-overlay" id="fadeoutOverlay">
        <div class="loader"></div>
    </div>
    <!-- Modale Réservations -->
    <div id="reservationModal" class="modal" style="display:none; position:fixed; z-index:3000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:12px; max-width:600px; width:95vw; padding:32px 24px; box-shadow:0 8px 32px rgba(44,62,80,0.18); position:relative;">
            <button id="closeReservationModal" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:22px; cursor:pointer; color:#888;">&times;</button>
            <h2 style="margin-top:0;">Mes réservations</h2>
            <div id="reservationModalContent">
                <div style="text-align:center; color:#888;">Chargement...</div>
            </div>
        </div>
    </div>
    <!-- Modale Commandes -->
    <div id="ordersModal" class="modal" style="display:none; position:fixed; z-index:3000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:12px; max-width:600px; width:95vw; padding:32px 24px; box-shadow:0 8px 32px rgba(44,62,80,0.18); position:relative;">
            <button id="closeOrdersModal" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:22px; cursor:pointer; color:#888;">&times;</button>
            <h2 style="margin-top:0;">Mes commandes</h2>
            <div id="ordersModalContent">
                <div style="text-align:center; color:#888;">Chargement...</div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const profileBtn = document.getElementById('profileDropdownBtn');
            const dropdown = document.getElementById('profileDropdownMenu');
            if (profileBtn && dropdown) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (!dropdown.classList.contains('open')) {
                        dropdown.classList.add('open');
                    } else {
                        dropdown.classList.remove('open');
                    }
                });
                document.addEventListener('click', function(e) {
                    if (!dropdown.contains(e.target) && !profileBtn.contains(e.target)) {
                        if (dropdown.classList.contains('open')) {
                            dropdown.classList.remove('open');
                        }
                    }
                });
                window.addEventListener('resize', function() {
                    dropdown.classList.remove('open');
                });
            }
            // Gestion modale réservations
            var reservationIcon = document.querySelector('.icon-link[title="Réservations"]');
            var reservationModal = document.getElementById('reservationModal');
            var closeReservationModal = document.getElementById('closeReservationModal');
            var reservationModalContent = document.getElementById('reservationModalContent');
            if (reservationIcon && reservationModal && closeReservationModal) {
                reservationIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    reservationModal.style.display = 'flex';
                    // Charger le contenu via AJAX
                    fetch('{% url 'reservations' %}?modal=1')
                        .then(response => response.text())
                        .then(html => { reservationModalContent.innerHTML = html; })
                        .catch(() => { reservationModalContent.innerHTML = '<div style="color:red;">Erreur de chargement</div>'; });
                });
                closeReservationModal.addEventListener('click', function() {
                    reservationModal.style.display = 'none';
                });
                reservationModal.addEventListener('click', function(e) {
                    if (e.target === reservationModal) reservationModal.style.display = 'none';
                });
            }
            // Gestion modale commandes
            var ordersIcon = document.querySelector('.icon-link[title="Commandes"]');
            var ordersModal = document.getElementById('ordersModal');
            var closeOrdersModal = document.getElementById('closeOrdersModal');
            var ordersModalContent = document.getElementById('ordersModalContent');
            if (ordersIcon && ordersModal && closeOrdersModal) {
                ordersIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    ordersModal.style.display = 'flex';
                    // Charger le contenu via AJAX
                    fetch('{% url 'commandes' %}?modal=1')
                        .then(response => response.text())
                        .then(html => { ordersModalContent.innerHTML = html; })
                        .catch(() => { ordersModalContent.innerHTML = '<div style="color:red;">Erreur de chargement</div>'; });
                });
                closeOrdersModal.addEventListener('click', function() {
                    ordersModal.style.display = 'none';
                });
                ordersModal.addEventListener('click', function(e) {
                    if (e.target === ordersModal) ordersModal.style.display = 'none';
                });
            }
        });
        (function() {
            var searchForm = document.querySelector('form.search-wrapper');
            var overlay = document.getElementById('fadeoutOverlay');
            if (searchForm && overlay) {
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    overlay.classList.add('visible');
                    setTimeout(function() {
                        // Construction de l'URL GET avec les paramètres du formulaire
                        var params = [];
                        for (var i = 0; i < searchForm.elements.length; i++) {
                            var el = searchForm.elements[i];
                            if (el.name && el.value) {
                                params.push(encodeURIComponent(el.name) + '=' + encodeURIComponent(el.value));
                            }
                        }
                        var action = searchForm.getAttribute('action') || window.location.pathname;
                        var url = action + (params.length ? ('?' + params.join('&')) : '');
                        window.location.href = url;
                    }, 700);
                });
            }
        })();
    </script>
</body>
</html> 